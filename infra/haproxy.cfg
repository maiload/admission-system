global
    maxconn 50000
    log stdout format raw local0

defaults
    mode http
    log global
    option httplog
    option dontlognull
    timeout connect 5s
    timeout client  60s
    timeout server  60s
    timeout tunnel  300s

# --- queue-gate (port 8010) ---
frontend ft_gate
    bind *:8010
    timeout client 300s
    default_backend bk_gate

backend bk_gate
    balance leastconn
    timeout server 300s
    option httpchk GET /actuator/health
    http-check expect status 200
    server gate1 queue-gate-1:8010 check inter 5s fall 3 rise 2
    server gate2 queue-gate-2:8010 check inter 5s fall 3 rise 2

# --- ticketing-core (port 8030) ---
frontend ft_core
    bind *:8030
    default_backend bk_core

backend bk_core
    balance leastconn
    option httpchk GET /actuator/health
    http-check expect status 200
    server core1 ticketing-core-1:8030 check inter 5s fall 3 rise 2
    server core2 ticketing-core-2:8030 check inter 5s fall 3 rise 2

# --- stats dashboard ---
frontend ft_stats
    bind *:9000
    stats enable
    stats uri /
    stats refresh 5s
